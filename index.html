<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Gaussian Splatting Viewer</title>
    <style>
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
        }
        
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            max-width: 280px;
            backdrop-filter: blur(10px);
        }
        
        #controls h2 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }
        
        #fileInput {
            display: none;
        }
        
        #fileLabel {
            display: block;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8ecff 100%);
            border: 2px dashed #667eea;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        #fileLabel:hover {
            border-color: #5a6fd8;
            background: linear-gradient(135deg, #e8ecff 0%, #d8e0ff 100%);
            transform: translateY(-2px);
        }
        
        .splat-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 10px;
            background: white;
        }
        
        .splat-item {
            padding: 12px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .splat-item:hover {
            background: #e8ecff;
            transform: translateX(5px);
        }
        
        .splat-item.active {
            background: linear-gradient(135deg, #667eea 0%, #5a6fd8 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        #info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            z-index: 1000;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        #instructions {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            max-width: 250px;
        }
        
        #instructions h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }
        
        #instructions ul {
            margin: 0;
            padding-left: 20px;
            color: #666;
        }
        
        #instructions li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="controls">
            <h2>3D Gaussian Splatting Viewer</h2>
            
            <div class="control-group">
                <label for="fileInput">é€‰æ‹© .splat æ–‡ä»¶:</label>
                <input type="file" id="fileInput" accept=".splat" multiple>
                <label for="fileInput" id="fileLabel">ğŸ“ ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½åˆ°æ­¤å¤„</label>
            </div>
            
            <div class="control-group">
                <label>é¢„è®¾æ¨¡å‹:</label>
                <div class="splat-list" id="splatList">
                    <div class="splat-item" data-file="bonsai-7k-mini.splat">ğŸŒ¸ Bonsai (7K)</div>
                    <div class="splat-item" data-file="test.splat">ğŸ§ª Test Model</div>
                    <div class="splat-item" data-file="origin.splat">ğŸ¯ Origin Model</div>
                    <div class="splat-item" data-file="rotation.splat">ğŸ”„ Rotation Model</div>
                    <div class="splat-item" data-file="r2.splat">âš¡ R2 Model</div>
                    <div class="splat-item" data-file="benz.splat">ğŸš— Benz Model</div>
                    <div class="splat-item" data-file="motor_benz.splat">ğŸï¸ Motor Benz</div>
                    <div class="splat-item" data-file="motor2.splat">ğŸï¸ Motor 2</div>
                    <div class="splat-item" data-file="point_cloud.splat">â˜ï¸ Point Cloud</div>
                </div>
            </div>
        </div>
        
        <div id="instructions">
            <h3>æ“ä½œè¯´æ˜</h3>
            <ul>
                <li>ğŸ–±ï¸ é¼ æ ‡æ‹–æ‹½ï¼šæ—‹è½¬è§†è§’</li>
                <li>ğŸ” æ»šè½®ï¼šç¼©æ”¾</li>
                <li>ğŸ“± æ”¯æŒè§¦æ‘¸æ“ä½œ</li>
            </ul>
        </div>
        
        <div id="info">
            <div>å½“å‰æ¨¡å‹: <span id="currentModel">æ— </span></div>
            <div>FPS: <span id="fps">0</span></div>
            <div>é¡¶ç‚¹æ•°: <span id="vertexCount">0</span></div>
        </div>
        
        <div id="loading">
            <span class="spinner"></span>
            æ­£åœ¨åŠ è½½æ¨¡å‹ï¼Œè¯·ç¨å€™...
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdnjs.cloudflare.com/ajax/libs/three.js/0.174.0/three.module.js",
                "@sparkjsdev/spark": "https://sparkjs.dev/releases/spark/0.1.8/spark.module.js"
            }
        }
    </script>
    
    <script type="module">
        import * as THREE from "three";
        import { SplatMesh } from "@sparkjsdev/spark";

        // åœºæ™¯è®¾ç½®
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);
        
        // ç›¸æœºè®¾ç½®
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0, 5);
        
        // æ¸²æŸ“å™¨è®¾ç½®
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById('container').appendChild(renderer.domElement);
        
        // æ·»åŠ ç¯å¢ƒå…‰
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        // æ·»åŠ æ–¹å‘å…‰
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(10, 10, 5);
        scene.add(directionalLight);
        
        // å˜é‡
        let currentSplat = null;
        let frameCount = 0;
        let lastTime = 0;
        let fps = 0;
        
        // DOM å…ƒç´ 
        const fileInput = document.getElementById('fileInput');
        const fileLabel = document.getElementById('fileLabel');
        const splatList = document.getElementById('splatList');
        const loading = document.getElementById('loading');
        const currentModelSpan = document.getElementById('currentModel');
        const fpsSpan = document.getElementById('fps');
        const vertexCountSpan = document.getElementById('vertexCount');
        
        // æ–‡ä»¶æ‹–æ‹½åŠŸèƒ½
        fileLabel.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileLabel.style.borderColor = '#5a6fd8';
            fileLabel.style.background = 'linear-gradient(135deg, #e8ecff 0%, #d8e0ff 100%)';
        });
        
        fileLabel.addEventListener('dragleave', (e) => {
            e.preventDefault();
            fileLabel.style.borderColor = '#667eea';
            fileLabel.style.background = 'linear-gradient(135deg, #f8f9ff 0%, #e8ecff 100%)';
        });
        
        fileLabel.addEventListener('drop', (e) => {
            e.preventDefault();
            fileLabel.style.borderColor = '#667eea';
            fileLabel.style.background = 'linear-gradient(135deg, #f8f9ff 0%, #e8ecff 100%)';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                loadSplatFile(files[0]);
            }
        });
        
        // æ–‡ä»¶é€‰æ‹©
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                loadSplatFile(e.target.files[0]);
            }
        });
        
        // é¢„è®¾æ¨¡å‹ç‚¹å‡»
        splatList.addEventListener('click', (e) => {
            if (e.target.classList.contains('splat-item')) {
                // ç§»é™¤ä¹‹å‰çš„activeç±»
                document.querySelectorAll('.splat-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // æ·»åŠ activeç±»åˆ°å½“å‰é¡¹
                e.target.classList.add('active');
                
                const fileName = e.target.dataset.file;
                loadSplatFileByName(fileName);
            }
        });
        
        // åŠ è½½splatæ–‡ä»¶
        async function loadSplatFile(file) {
            try {
                loading.style.display = 'block';
                
                // ç§»é™¤ä¹‹å‰çš„æ¨¡å‹
                if (currentSplat) {
                    scene.remove(currentSplat);
                }
                
                // åˆ›å»ºæ–‡ä»¶URL
                const fileURL = URL.createObjectURL(file);
                
                // åˆ›å»ºæ–°çš„SplatMesh
                currentSplat = new SplatMesh({ url: fileURL });
                currentSplat.position.set(0, 0, 0);
                
                // æ·»åŠ åˆ°åœºæ™¯
                scene.add(currentSplat);
                
                // æ›´æ–°ä¿¡æ¯
                currentModelSpan.textContent = file.name;
                
                // è‡ªåŠ¨è°ƒæ•´ç›¸æœºä½ç½®
                setTimeout(() => {
                    if (currentSplat && currentSplat.geometry) {
                        vertexCountSpan.textContent = currentSplat.geometry.attributes.position.count.toLocaleString();
                        
                        const box = new THREE.Box3().setFromObject(currentSplat);
                        const size = box.getSize(new THREE.Vector3());
                        const maxDim = Math.max(size.x, size.y, size.z);
                        const distance = maxDim * 2;
                        camera.position.set(distance, distance, distance);
                        camera.lookAt(0, 0, 0);
                    }
                }, 100);
                
                loading.style.display = 'none';
                
            } catch (error) {
                console.error('åŠ è½½splatæ–‡ä»¶å¤±è´¥:', error);
                loading.style.display = 'none';
                alert('åŠ è½½æ–‡ä»¶å¤±è´¥: ' + error.message);
            }
        }
        
        // åŠ è½½é¢„è®¾æ¨¡å‹
        async function loadSplatFileByName(fileName) {
            try {
                loading.style.display = 'block';
                
                // ç§»é™¤ä¹‹å‰çš„æ¨¡å‹
                if (currentSplat) {
                    scene.remove(currentSplat);
                }
                
                // åˆ›å»ºæ–°çš„SplatMesh
                currentSplat = new SplatMesh({ url: fileName });
                currentSplat.position.set(0, 0, 0);
                
                // æ·»åŠ åˆ°åœºæ™¯
                scene.add(currentSplat);
                
                // æ›´æ–°ä¿¡æ¯
                currentModelSpan.textContent = fileName;
                
                // è‡ªåŠ¨è°ƒæ•´ç›¸æœºä½ç½®
                setTimeout(() => {
                    if (currentSplat && currentSplat.geometry) {
                        vertexCountSpan.textContent = currentSplat.geometry.attributes.position.count.toLocaleString();
                        
                        const box = new THREE.Box3().setFromObject(currentSplat);
                        const size = box.getSize(new THREE.Vector3());
                        const maxDim = Math.max(size.x, size.y, size.z);
                        const distance = maxDim * 2;
                        camera.position.set(distance, distance, distance);
                        camera.lookAt(0, 0, 0);
                    }
                }, 100);
                
                loading.style.display = 'none';
                
            } catch (error) {
                console.error('åŠ è½½splatæ–‡ä»¶å¤±è´¥:', error);
                loading.style.display = 'none';
                alert('åŠ è½½æ–‡ä»¶å¤±è´¥: ' + error.message);
            }
        }
        
        // çª—å£å¤§å°è°ƒæ•´
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // é¼ æ ‡æ§åˆ¶
        let isMouseDown = false;
        let mouseX = 0;
        let mouseY = 0;
        
        renderer.domElement.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            mouseX = e.clientX;
            mouseY = e.clientY;
        });
        
        renderer.domElement.addEventListener('mousemove', (e) => {
            if (isMouseDown) {
                const deltaX = e.clientX - mouseX;
                const deltaY = e.clientY - mouseY;
                
                // æ—‹è½¬ç›¸æœº
                const spherical = new THREE.Spherical();
                spherical.setFromVector3(camera.position);
                spherical.theta -= deltaX * 0.01;
                spherical.phi += deltaY * 0.01;
                spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
                
                camera.position.setFromSpherical(spherical);
                camera.lookAt(0, 0, 0);
                
                mouseX = e.clientX;
                mouseY = e.clientY;
            }
        });
        
        renderer.domElement.addEventListener('mouseup', () => {
            isMouseDown = false;
        });
        
        // æ»šè½®ç¼©æ”¾
        renderer.domElement.addEventListener('wheel', (e) => {
            const zoomSpeed = 0.1;
            const direction = e.deltaY > 0 ? 1 : -1;
            camera.position.multiplyScalar(1 + direction * zoomSpeed);
        });
        
        // è§¦æ‘¸æ§åˆ¶
        let touchStartX = 0;
        let touchStartY = 0;
        
        renderer.domElement.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
        });
        
        renderer.domElement.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const deltaX = touch.clientX - touchStartX;
            const deltaY = touch.clientY - touchStartY;
            
            // æ—‹è½¬ç›¸æœº
            const spherical = new THREE.Spherical();
            spherical.setFromVector3(camera.position);
            spherical.theta -= deltaX * 0.01;
            spherical.phi += deltaY * 0.01;
            spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
            
            camera.position.setFromSpherical(spherical);
            camera.lookAt(0, 0, 0);
            
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
        });
        
        // åŠ¨ç”»å¾ªç¯
        function animate(time) {
            requestAnimationFrame(animate);
            
            // è®¡ç®—FPS
            frameCount++;
            if (time - lastTime >= 1000) {
                fps = Math.round((frameCount * 1000) / (time - lastTime));
                fpsSpan.textContent = fps;
                frameCount = 0;
                lastTime = time;
            }
            
            renderer.render(scene, camera);
        }
        
        // å¯åŠ¨åŠ¨ç”»
        animate(0);
        
        // é»˜è®¤åŠ è½½ç¬¬ä¸€ä¸ªæ¨¡å‹
        setTimeout(() => {
            const firstItem = document.querySelector('.splat-item');
            if (firstItem) {
                firstItem.classList.add('active');
                loadSplatFileByName(firstItem.dataset.file);
            }
        }, 100);
    </script>
</body>
</html>
</html>